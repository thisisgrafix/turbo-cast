<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Scanner Feed</title>
    <script src="https://www.gstatic.com/cast/sdk/libs/sender/1.0/cast_framework.js"></script>
</head>
<body>
    <h1>Broadcastify Scanner Feeds</h1>
    
    <button id="castButton">Cast to Google Home</button>
    
    <h2>Available Feeds</h2>
    <ul>
        <li><button onclick="castAudio('https://broadcastify.cdnstream1.com/12345')">Feed 1</button></li>
        <li><button onclick="castAudio('https://broadcastify.cdnstream1.com/67890')">Feed 2</button></li>
        <!-- Add more feeds here as needed -->
    </ul>

    <script>
        // Ensure Cast SDK is initialized
        const castContext = cast.framework.CastContext.getInstance();

        // CastContext initialization options
        castContext.setOptions({
            receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID, // Default receiver app
            autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED // Allow auto-join within the origin
        });

        // Log the context and verify initialization
        console.log("Cast SDK Initialized:", castContext);

        // Cast button listener - let user connect to Google Home
        const castButton = document.getElementById("castButton");
        castButton.addEventListener("click", () => {
            // Request a session to cast to
            console.log("Requesting session...");
            castContext.requestSession().then(
                (session) => {
                    console.log("Session successfully started:", session);
                },
                (error) => {
                    console.error("Error requesting session:", error);
                }
            );
        });

        // Function to cast audio to Google Home
        function castAudio(feedUrl) {
            const currentSession = castContext.getCurrentSession();
            
            // Check if session exists
            if (!currentSession) {
                alert("Please connect to a Google Home first!");
                return;  // Exit the function if no session exists
            }

            // Set up the media information for the selected feed
            const mediaInfo = new chrome.cast.media.MediaInfo(feedUrl, 'audio/mp3');
            const request = new chrome.cast.media.LoadRequest(mediaInfo);

            // Load and start the media
            currentSession.loadMedia(request).then(
                () => { console.log('Stream started!'); },
                (error) => { console.error('Failed to load media:', error); }
            );
        }
    </script>
</body>
</html>
